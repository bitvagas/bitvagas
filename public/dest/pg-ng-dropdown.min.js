"use strict";!function(){function dropdownDirective($timeout,$document){function compile($element,attrs){return attrs.value=attrs.value||0,attrs.textProperty=attrs.textProperty||"text",attrs.imageProperty=attrs.imagetProperty||"image",{post:postLink}}function controller($scope){function selectOption(_index){if(_index!==parseInt(vm.value)){var _pastSelected=vm.value;_index=parseInt(_index),vm.value=_index,vm.data[_index].selected=!0,vm.data[_pastSelected]&&(vm.data[_pastSelected].selected=null),vm.onchange(),$scope.$broadcast("pg-option-selected",{index:_index,pastIndex:_pastSelected})}}function toggle(){vm.opened?(vm.opened=!1,$scope.$broadcast("pg-close-dropdown")):(vm.opened=!0,$scope.$broadcast("pg-open-dropdown"))}function open(){vm.opened=!0,$scope.$broadcast("pg-open-dropdown")}function close(){vm.opened=!1,$scope.$broadcast("pg-close-dropdown")}var vm=this;vm.opened=!1,vm.currentOption=-1,vm.selectOption=selectOption,vm.open=open,vm.close=close,vm.toggle=toggle,$scope.$watch("data",function(){$scope.$broadcast("options-changed")}),"number"==typeof vm.value&&(vm.data[vm.value].selected=!0)}function postLink($scope,$element,attrs,ctrl){function select($evt,data){options.eq(data.index).addClass(selectedClass),options.eq(data.pastIndex).removeClass(selectedClass)}function open(){$element.addClass(openedClass),ctrl.dynamicHeight&&$element.css("height",openedHeight+"px")}function close(){$element.removeClass(openedClass),ctrl.currentOption>0&&(options.eq(ctrl.currentOption).removeClass("focused"),ctrl.currentOption=-1),ctrl.dynamicHeight&&$element.css("height",closedHeight+"px")}function elementClick(evt){evt.stopPropagation()}function selectEvt($evt,data){ctrl.name===data.name&&$scope.$apply(function(){ctrl.selectOption(data.index)})}function openEvt($evt,data){ctrl.name===data.name&&ctrl.open()}function closeEvt($evt,data){ctrl.name===data.name&&ctrl.close()}function keydown(evt){var _code=evt.keyCode||evt.which;13===_code?(evt.preventDefault(),ctrl.opened?ctrl.opened&&-1!=ctrl.currentOption&&ctrl.currentOption!=ctrl.value&&$scope.$apply(function(){ctrl.selectOption(ctrl.currentOption)}):ctrl.open()):27===_code?(evt.preventDefault(),ctrl.opened&&ctrl.close()):38===_code?(evt.preventDefault(),ctrl.currentOption-1>=0&&(options.eq(ctrl.currentOption).removeClass("focused"),ctrl.currentOption--,options.eq(ctrl.currentOption).addClass("focused"),ctrl.currentOption<options.length&&(optionsWrapper[0].scrollTop-=optionHeight))):40===_code&&(evt.preventDefault(),ctrl.currentOption+1<options.length&&(options.eq(ctrl.currentOption).removeClass("focused"),ctrl.currentOption++,options.eq(ctrl.currentOption).addClass("focused"),ctrl.currentOption>1&&(optionsWrapper[0].scrollTop+=optionHeight)))}function measureHeight(){var _style=window.getComputedStyle(optionsWrapper[0]),_padding=parseInt(_style.paddingTop)+parseInt(_style.paddingBottom),_margin=parseInt(_style.marginTop)+parseInt(_style.marginBottom);closedHeight=$element.prop("offsetHeight"),openedHeight=optionHeight*options.length+closedHeight+_padding+_margin}function destroy(){$document.off("click"),$open(),$close(),$select(),$optionsChanged(),$closeThis(),$openThis(),$selectThis()}var optionsWrapper,options,optionHeight,closedHeight,openedHeight,openedClass="opened",selectedClass="selected";if(ctrl.openedClass)var openedClass=ctrl.openedClass;if(ctrl.selectedClass)var selectedClass=ctrl.selectedClass;var $open=$scope.$on("pg-open-dropdown",open),$close=$scope.$on("pg-close-dropdown",close),$openThis=$scope.$on("pg-dropdown-open",openEvt),$closeThis=$scope.$on("pg-dropdown-close",closeEvt),$selectThis=$scope.$on("pg-select-option",selectEvt),$optionsChanged=$scope.$on("pg-options-changed",measureHeight),$select=$scope.$on("pg-option-selected",function($evt,data){select($evt,data),ctrl.close()});$element.on("click",elementClick),$document.on("click",ctrl.close),$element.on("keydown",keydown),$scope.$on("$destroy",destroy),$timeout(function(){optionsWrapper=$element.find("ul"),options=optionsWrapper.find("li"),options.eq(ctrl.value).addClass(selectedClass),optionHeight=options.eq(0).prop("offsetHeight"),ctrl.dynamicHeight&&measureHeight()})}var template=['<div class="pg-dropdown">','<div data-ng-click="ctrl.toggle()" class="current-selected-option">',"<i data-ng-if=\"ctrl.image == 'true'\" data-ng-style=\"{'background-image': 'url('+(ctrl.data[ctrl.value][ctrl.imageProperty])+')'}\">","</i>",'<span data-ng-bind="ctrl.data[ctrl.value][ctrl.textProperty] || ctrl.value">',"</span>",'<div class="arrow-wrapper">','<div class="arrow"></div>',"</div>",'<div style="clear:both;"></div>',"</div>",'<ul class="dropdown-content">','<li data-ng-click="ctrl.selectOption($index)" data-ng-repeat="option in ctrl.data" title="{{option[ctrl.textProperty]}}" >',"<i data-ng-if=\"ctrl.image == 'true'\" data-ng-style=\"{'background-image': 'url('+(option[ctrl.imageProperty])+')'}\">","</i>",'<span data-ng-bind="option[ctrl.textProperty]">',"</span>",'<div style="clear:both;"></div>',"</li>","</ul>","</div>"].join(""),directive={scope:{data:"=options",image:"@imageOptions",imageProperty:"@",value:"@selected",name:"@",textProperty:"@",openedClass:"@",selectedClass:"@",onchange:"&",dynamicHeight:"@"},restrict:"AEC",compile:compile,controller:controller,controllerAs:"ctrl",bindToController:!0,replace:!0,template:template};return directive}angular.module("pg-ng-dropdown",[]).directive("pgNgDropdown",dropdownDirective),dropdownDirective.$inject=["$timeout","$document"]}();